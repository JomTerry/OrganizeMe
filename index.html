<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OrganizeMe</title>

<!-- Try to load external stylesheet if present -->
<link id="ext-style" rel="stylesheet" href="style.css" onerror="window.__styleLoaded=false" />
<style id="fallback-style">
  :root{--bg:#f5f7fb;--card:#fff;--accent:#0b63d6;--muted:#6b7280}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  body{background:var(--bg);-webkit-font-smoothing:antialiased}
  header{background:linear-gradient(90deg,var(--accent),#2a9df4);color:#fff;padding:14px 16px}
  .wrap{max-width:980px;margin:18px auto;padding:0 16px}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,.06)}
  .row{display:flex;gap:8px;align-items:center}
  input,select,textarea,button{font:inherit}
  input,select,textarea{padding:8px;border-radius:8px;border:1px solid #e6e9ee}
  button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  button.ghost{background:transparent;color:var(--muted);border:1px solid #e6e9ee}
  ul.task-list{list-style:none;padding:0;margin:0;display:grid;gap:8px}
  li.task{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:10px;border-radius:8px;background:#fafafa}
  .meta{font-size:13px;color:var(--muted)}
  .badge{padding:4px 8px;border-radius:999px;font-weight:600;font-size:12px}
  .high{background:#ffe9e9;color:#9b1c1c}
  .med{background:#fff7e6;color:#8a5700}
  .low{background:#e9f7ff;color:#03506f}
  .empty{text-align:center;color:var(--muted);padding:18px}
  @media(min-width:720px){.form-grid{display:flex;gap:10px;align-items:flex-end}}

  /* Modal styles */
  .modal{position:fixed;inset:0;display:block;z-index:1000}
  .modal[style*="display:none"]{display:none}
  .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.4)}
  .modal-card{position:relative;margin:10vh auto;background:#fff;border-radius:12px;max-width:440px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.2)}
  .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .icon-btn{background:transparent;border:0;font-size:18px;cursor:pointer;color:#374151}
  .tab-row{display:flex;gap:8px;margin-bottom:10px}
  .tab{background:#f3f4f6;color:#374151;border:1px solid #e5e7eb;padding:6px 10px;border-radius:999px;cursor:pointer}
  .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
  .col{display:flex;flex-direction:column}
  .password-field{position:relative;display:flex;align-items:center}
  .password-field input{flex:1;padding-right:64px}
  .password-field .toggle{position:absolute;right:6px;background:transparent;border:0;color:#374151;cursor:pointer;padding:4px 8px}
.oauth-btn img{width:18px;height:18px}
</style>
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: 'AIzaSyBWawjroPfOoWvUz4VKstv8gn3UYVpLgC4',
      authDomain: 'jomterryy417-c0c.firebaseapp.com',
      projectId: 'jomterryy417-c0c',
      storageBucket: 'jomterryy417-c0c.appspot.com',
      messagingSenderId: '993273611189',
      appId: '1:993273611189:web:baba2cdc4ff30682904ffc',
    };
  </script>
</head>
<body>
<header>
  <div class="wrap">
    <h1 style="margin:.1rem 0">OrganizeMe</h1>
    <div style="opacity:.95">Task manager — web fallback included</div>
    </div>
  </header>
  
  <section class="wrap" id="auth" style="margin-top:14px">
    <div class="card" style="display:flex;gap:12px;align-items:center;justify-content:space-between">
      <div id="auth-status" style="flex:1">
        <div class="row" id="signed-out-row">
          <strong>Welcome!</strong>
          <span class="meta">Sign in to sync across devices.</span>
        </div>
        <div class="row" id="signed-in-row" style="display:none">
          <span>Signed in as <strong id="auth-email"></strong></span>
          <button id="signout-btn" class="ghost" style="margin-left:auto">Sign out</button>
        </div>
      </div>
      <div class="row" style="gap:12px">
        <button id="open-auth" class="ghost">Sign in / Sign up</button>
      </div>
    </div>
  </section>

  <!-- Auth Modal -->
  <div id="auth-modal" class="modal" style="display:none">
    <div class="modal-backdrop" id="auth-backdrop"></div>
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="auth-modal-title" style="margin:0">Sign in</h3>
        <button id="auth-close" class="icon-btn" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <div class="tab-row">
          <button id="tab-signin" class="tab active" type="button">Sign in</button>
          <button id="tab-signup" class="tab" type="button">Sign up</button>
        </div>

        <div class="oauth" style="display:flex;flex-direction:column;gap:8px;margin-bottom:10px;align-items:stretch">
          <button id="google-btn" type="button" class="oauth-btn" style="display:flex;align-items:center;justify-content:center;gap:8px;background:#fff;color:#374151;border:1px solid #e5e7eb">Continue with Google</button>
          <div class="meta" style="text-align:center">or</div>
        </div>

        <form id="signin-form" onsubmit="return false;" class="col" style="gap:10px">
          <input id="modal-signin-email" type="email" placeholder="Email" required />
          <div class="password-field">
            <input id="modal-signin-password" type="password" placeholder="Password" required />
            <button type="button" class="toggle" id="toggle-signin-pwd">Show</button>
          </div>
          <button id="modal-signin-btn">Sign in</button>
        </form>

        <form id="signup-form" onsubmit="return false;" class="col" style="gap:10px; display:none">
          <input id="modal-signup-email" type="email" placeholder="Email" required />
          <div class="password-field">
            <input id="modal-signup-password" type="password" placeholder="Password (min 6)" minlength="6" required />
            <button type="button" class="toggle" id="toggle-signup-pwd">Show</button>
          </div>
          <div class="password-field">
            <input id="modal-signup-confirm" type="password" placeholder="Confirm password" minlength="6" required />
            <button type="button" class="toggle" id="toggle-signup-confirm">Show</button>
          </div>
          <button id="modal-signup-btn">Create account</button>
        </form>
      </div>
    </div>
  </div>

  <main class="wrap" style="margin-top:14px">
  <section class="card" id="creator">
    <form id="task-form" onsubmit="return false;">
      <div class="form-grid">
        <div style="flex:1">
          <label>Task</label><br>
          <input id="title" placeholder="e.g. Finish report" required />
        </div>
        <div style="width:140px">
          <label>Due</label><br>
          <input id="due" type="date" />
        </div>
        <div style="width:120px">
          <label>Priority</label><br>
          <select id="importance">
            <option>High</option><option selected>Medium</option><option>Low</option>
          </select>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="add-btn" onclick="addTask()">Add</button>
          <button id="clear-all" class="ghost" onclick="clearAll()">Clear</button>
        </div>
      </div>
    </form>
  </section>

  <section class="card" style="margin-top:12px">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
      <label>View:</label>
      <select id="view-mode" onchange="render()">
        <option value="priority">Priority then due</option>
        <option value="date">Earliest due</option>
      </select>
      <label style="margin-left:auto"><input id="show-complete" type="checkbox" onchange="render()"> Show completed</label>
    </div>

    <div id="list-wrap"><div class="empty">Loading…</div></div>
  </section>
</main>

<script>
/*
  Behavior:
  - Try to load external index.js by adding <script src="index.js">.
  - If it fails to load (404), fallback to built-in app implementation below.
*/
(function bootstrap(){
  // Try to load external JS; if fails, run fallback
  var s = document.createElement('script');
  s.src = 'index.js';
  s.onload = function(){ console.log('External index.js loaded. Using external script.'); };
  s.onerror = function(){
    console.warn('No external index.js found — running fallback UI logic.');
    // Load Firebase Web SDK for web fallback auth
    var f = document.createElement('script');
    f.type = 'module';
    f.innerHTML = `
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
      import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
      const cfg = {
        apiKey: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.apiKey) || 'YOUR_API_KEY',
        authDomain: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.authDomain) || 'YOUR_AUTH_DOMAIN',
        projectId: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.projectId) || 'YOUR_PROJECT_ID',
        storageBucket: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.storageBucket) || 'YOUR_STORAGE_BUCKET',
        messagingSenderId: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.messagingSenderId) || 'YOUR_MESSAGING_SENDER_ID',
        appId: (window.FIREBASE_CONFIG && FIREBASE_CONFIG.appId) || 'YOUR_APP_ID',
      };
      const app = initializeApp(cfg);
      const auth = getAuth(app);
      const googleProvider = new GoogleAuthProvider();
      const $ = (id) => document.getElementById(id);
      function showSignedIn(email){
        $('signed-in-row').style.display='flex';
        $('signed-out-row').style.display='none';
        $('auth-email').textContent = email || '';
        closeModal();
      }
      function showSignedOut(){
        $('signed-in-row').style.display='none';
        $('signed-out-row').style.display='flex';
      }
      function openModal(){ $('auth-modal').style.display='block'; selectTab('signin'); }
      function closeModal(){ $('auth-modal').style.display='none'; }
      function togglePassword(id, btn){ const i=$(id); const on=i.type==='password'; i.type=on?'text':'password'; btn.textContent=on?'Hide':'Show'; }
      function selectTab(which){
        const signinActive = which==='signin';
        $('tab-signin').classList.toggle('active', signinActive);
        $('tab-signup').classList.toggle('active', !signinActive);
        $('signin-form').style.display = signinActive ? 'flex' : 'none';
        $('signup-form').style.display = signinActive ? 'none' : 'flex';
        $('auth-modal-title').textContent = signinActive ? 'Sign in' : 'Sign up';
      }
      onAuthStateChanged(auth, (u)=>{ if(u) showSignedIn(u.email); else showSignedOut(); });
      $('modal-signin-btn').onclick = async ()=>{
        try { await signInWithEmailAndPassword(auth, $('modal-signin-email').value.trim(), $('modal-signin-password').value); }
        catch(e){ alert(e.message || 'Sign-in failed'); }
      };
      $('modal-signup-btn').onclick = async ()=>{
        const email = $('modal-signup-email').value.trim();
        const p1 = $('modal-signup-password').value;
        const p2 = $('modal-signup-confirm').value;
        if(p1!==p2) return alert('Passwords do not match');
        try { await createUserWithEmailAndPassword(auth, email, p1); }
        catch(e){ alert(e.message || 'Sign-up failed'); }
      };
      $('google-btn').onclick = async ()=>{
        try { await signInWithPopup(auth, googleProvider); }
        catch(e){ alert(e.message || 'Google sign-in failed'); }
      };
      $('signout-btn').onclick = async ()=>{ try{ await signOut(auth); }catch(e){ alert(e.message || 'Sign-out failed'); } };
      $('open-auth').onclick = ()=> openModal();
      $('auth-close').onclick = ()=> closeModal();
      $('auth-backdrop').onclick = ()=> closeModal();
      $('tab-signin').onclick = ()=> selectTab('signin');
      $('tab-signup').onclick = ()=> selectTab('signup');
      $('toggle-signin-pwd').onclick = (e)=>{ e.preventDefault(); togglePassword('modal-signin-password', e.currentTarget); };
      $('toggle-signup-pwd').onclick = (e)=>{ e.preventDefault(); togglePassword('modal-signup-password', e.currentTarget); };
      $('toggle-signup-confirm').onclick = (e)=>{ e.preventDefault(); togglePassword('modal-signup-confirm', e.currentTarget); };
    `;
    document.body.appendChild(f);
    runFallbackApp();
  };
  document.body.appendChild(s);

  // If style.css failed to load, the fallback style element stays applied (already in HTML).
  var extStyle = document.getElementById('ext-style');
  extStyle.onerror = function(){ window.__styleLoaded=false; /* fallback style already present */ };
})();

/* ============================
   Fallback in-browser app
   ============================ */
function runFallbackApp(){
  // keep everything scoped; don't overwrite if an external app already defines functions
  if (window.__organizeMeFallbackRan) return;
  window.__organizeMeFallbackRan = true;

  const STORAGE_KEY = 'organizeMe.tasks.v1';
  let tasks = [];
  const title = document.getElementById('title');
  const due = document.getElementById('due');
  const importance = document.getElementById('importance');
  const listWrap = document.getElementById('list-wrap');
  const viewMode = document.getElementById('view-mode');
  const showComplete = document.getElementById('show-complete');

  function load(){ try{ tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }catch(e){ tasks=[]; } }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }
  function uid(){ return Math.random().toString(36).slice(2,9); }
  function importanceRank(i){ return ({High:3,Medium:2,Low:1}[i]||0); }
  function isDueSoon(d){
    if(!d) return false;
    const diff = new Date(d+'T23:59:59').getTime() - Date.now();
    return diff>0 && diff <= (1000*60*60*24*2);
  }

  function render(){
    const visible = tasks.filter(t => showComplete.checked ? true : !t.done);
    if (!visible.length){ listWrap.innerHTML='<div class="empty">No tasks yet — add one above.</div>'; return; }
    if (viewMode.value === 'date'){
      visible.sort((a,b) => { if(!a.due && !b.due) return 0; if(!a.due) return 1; if(!b.due) return -1; return new Date(a.due)-new Date(b.due); });
    } else {
      visible.sort((a,b)=>{ const imp=importanceRank(b.importance)-importanceRank(a.importance); if(imp) return imp; if(!a.due&&!b.due) return 0; if(!a.due) return 1; if(!b.due) return -1; return new Date(a.due)-new Date(b.due); });
    }

    const ul = document.createElement('ul'); ul.className='task-list';
    visible.forEach(t=>{
      const li = document.createElement('li'); li.className='task';
      if (t.done) li.classList.add('completed');

      const left = document.createElement('div'); left.style.display='flex'; left.style.gap='10px'; left.style.alignItems='center';
      const badge = document.createElement('div'); badge.className='badge ' + (t.importance==='High'?'high':t.importance==='Medium'?'med':'low'); badge.textContent = t.importance;
      const info = document.createElement('div');
      const titleEl = document.createElement('div'); titleEl.innerHTML = '<strong>'+escapeHtml(t.title)+'</strong>';
      const meta = document.createElement('div'); meta.className='meta';
      const dueText = t.due ? 'Due '+t.due : 'No due date';
      const soon = isDueSoon(t.due) && !t.done ? " • <span style=\"color:#b91c1c;font-weight:600\">due soon</span>" : '';
      meta.innerHTML = dueText + (t.notes?(' • '+escapeHtml(t.notes)) : '') + soon;
      info.appendChild(titleEl); info.appendChild(meta);
      left.appendChild(badge); left.appendChild(info);

      const ctr = document.createElement('div'); ctr.style.display='flex'; ctr.style.gap='8px';
      const doneBtn = document.createElement('button'); doneBtn.textContent = t.done ? 'Undo' : 'Done';
      doneBtn.onclick = ()=>{ t.done = !t.done; save(); render(); };
      const editBtn = document.createElement('button'); editBtn.className='ghost'; editBtn.textContent='Edit';
      editBtn.onclick = ()=>{ openEdit(t); };
      const delBtn = document.createElement('button'); delBtn.className='ghost'; delBtn.textContent='Delete';
      delBtn.onclick = ()=>{ if(confirm('Delete this task?')){ tasks = tasks.filter(x=>x.id!==t.id); save(); render(); } };
      ctr.appendChild(doneBtn); ctr.appendChild(editBtn); ctr.appendChild(delBtn);

      li.appendChild(left); li.appendChild(ctr);
      ul.appendChild(li);
    });
    listWrap.innerHTML=''; listWrap.appendChild(ul);
  }

  function escapeHtml(s){ return String(s||'').replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;' }[c])); }

  function addTask(){
    const t = { id: uid(), title: title.value.trim(), notes: '', due: due.value || null, importance: importance.value, done:false, createdAt:new Date().toISOString() };
    if (!t.title) return alert('Give the task a name.');
    tasks.push(t); save(); render(); title.value=''; due.value=''; importance.value='Medium';
  }

  function openEdit(task){
    const newTitle = prompt('Edit title', task.title);
    if (newTitle === null) return;
    task.title = newTitle.trim() || task.title;
    const newNotes = prompt('Edit notes', task.notes||'');
    if (newNotes !== null) task.notes = newNotes.trim();
    const newDue = prompt('Due (YYYY-MM-DD) or blank', task.due||'');
    if (newDue !== null) task.due = newDue.trim() || null;
    const newImp = prompt('Importance: High / Medium / Low', task.importance) || task.importance;
    if (['High','Medium','Low'].includes(newImp)) task.importance = newImp;
    save(); render();
  }

  function clearAll(){ if(!confirm('Clear all tasks?')) return; tasks=[]; save(); render(); }

  // UI hookup
  window.addEventListener('DOMContentLoaded', ()=>{ /* no-op: already DOM loaded */});
  document.getElementById('add-btn').addEventListener('click', addTask);
  document.getElementById('clear-all').addEventListener('click', ()=>{ clearAll(); });

  viewMode.addEventListener('change', render);
  showComplete.addEventListener('change', render);

  load(); render();

  // expose for debug
  window.OrganizeMe = { load, save, tasks, render };
}
</script>
</body>
</html>